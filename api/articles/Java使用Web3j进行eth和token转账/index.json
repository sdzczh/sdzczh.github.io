{"title":"Java使用Web3j进行eth和token转账","uid":"36c610caa1e43df0d3165a993cf0c93d","slug":"Java使用Web3j进行eth和token转账/index","date":"2022-03-16T17:03:24.000Z","updated":"2022-03-16T17:04:04.134Z","comments":true,"path":"api/articles/Java使用Web3j进行eth和token转账/index.json","keywords":null,"cover":null,"content":"<h2 id=\"ETH转账\"><a href=\"#ETH转账\" class=\"headerlink\" title=\"ETH转账\"></a>ETH转账</h2><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">Web3j</span> web3j <span class=\"token operator\">=</span> <span class=\"token class-name\">Web3j</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpService</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"infura节点链接\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">BigInteger</span> bigInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigInteger</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"钱包私钥\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">ECKeyPair</span> ecKeyPair <span class=\"token operator\">=</span> <span class=\"token class-name\">ECKeyPair</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>bigInteger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Credentials</span> credentials <span class=\"token operator\">=</span> <span class=\"token class-name\">Credentials</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>ecKeyPair<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">TransactionReceipt</span> transactionReceipt <span class=\"token operator\">=</span> <span class=\"token class-name\">Transfer</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendFunds</span><span class=\"token punctuation\">(</span>web3j<span class=\"token punctuation\">,</span> credentials<span class=\"token punctuation\">,</span> <span class=\"token string\">\"目标地址\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Convert<span class=\"token punctuation\">.</span>Unit</span><span class=\"token punctuation\">.</span>ETHER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>transactionReceipt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"Token转账\"><a href=\"#Token转账\" class=\"headerlink\" title=\"Token转账\"></a>Token转账</h2><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">transferToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">Web3j</span> web3j <span class=\"token operator\">=</span> <span class=\"token class-name\">Web3j</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpService</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"infura节点链接\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">BigInteger</span> bigInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigInteger</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"私钥\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">ECKeyPair</span> ecKeyPair <span class=\"token operator\">=</span> <span class=\"token class-name\">ECKeyPair</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>bigInteger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Credentials</span> credentials <span class=\"token operator\">=</span> <span class=\"token class-name\">Credentials</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>ecKeyPair<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> fromAddress <span class=\"token operator\">=</span> credentials<span class=\"token punctuation\">.</span><span class=\"token function\">getAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">EthGetTransactionCount</span> ethGetTransactionCount <span class=\"token operator\">=</span> web3j<span class=\"token punctuation\">.</span><span class=\"token function\">ethGetTransactionCount</span><span class=\"token punctuation\">(</span>\n            fromAddress<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DefaultBlockParameterName</span><span class=\"token punctuation\">.</span>LATEST<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">BigInteger</span> nonce <span class=\"token operator\">=</span> ethGetTransactionCount<span class=\"token punctuation\">.</span><span class=\"token function\">getTransactionCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Address</span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"目标地址\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Uint256</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint256</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BigInteger</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"数量 单位wei\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Type</span><span class=\"token punctuation\">></span></span> parametersList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    parametersList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    parametersList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TypeReference</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> outList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Function</span> function <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Function</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transfer\"</span><span class=\"token punctuation\">,</span> parametersList<span class=\"token punctuation\">,</span> outList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> encodedFunction <span class=\"token operator\">=</span> <span class=\"token class-name\">FunctionEncoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>function<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">DefaultGasProvider</span><span class=\"token punctuation\">.</span>GAS_PRICE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DefaultGasProvider</span><span class=\"token punctuation\">.</span>GAS_LIMIT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">RawTransaction</span> rawTransaction <span class=\"token operator\">=</span> <span class=\"token class-name\">RawTransaction</span><span class=\"token punctuation\">.</span><span class=\"token function\">createTransaction</span><span class=\"token punctuation\">(</span>nonce<span class=\"token punctuation\">,</span>  <span class=\"token class-name\">DefaultGasProvider</span><span class=\"token punctuation\">.</span>GAS_PRICE<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigInteger</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"210000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"合约地址\"</span><span class=\"token punctuation\">,</span> encodedFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> signedMessage <span class=\"token operator\">=</span> <span class=\"token class-name\">TransactionEncoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">signMessage</span><span class=\"token punctuation\">(</span>rawTransaction<span class=\"token punctuation\">,</span> credentials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> hexValue <span class=\"token operator\">=</span> <span class=\"token class-name\">Numeric</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHexString</span><span class=\"token punctuation\">(</span>signedMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">EthSendTransaction</span> ethSendTransaction <span class=\"token operator\">=</span> web3j<span class=\"token punctuation\">.</span><span class=\"token function\">ethSendRawTransaction</span><span class=\"token punctuation\">(</span>hexValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Object</span> transactionHash <span class=\"token operator\">=</span> ethSendTransaction<span class=\"token punctuation\">.</span><span class=\"token function\">getTransactionHash</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>transactionHash<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","text":"ETH转账public static void transfer() throws Exception &#123; Web3j web3j = Web3j.build(new HttpService(\"infura节点链接\")); BigInteger bigInteger =...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"Web3","slug":"Web3","count":1,"path":"api/categories/Web3.json"}],"tags":[{"name":"区块链","slug":"区块链","count":5,"path":"api/tags/区块链.json"},{"name":"Java","slug":"Java","count":1,"path":"api/tags/Java.json"},{"name":"Web3j","slug":"Web3j","count":1,"path":"api/tags/Web3j.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ETH%E8%BD%AC%E8%B4%A6\"><span class=\"toc-text\">ETH转账</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Token%E8%BD%AC%E8%B4%A6\"><span class=\"toc-text\">Token转账</span></a></li></ol>","author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Linux常见命令","uid":"b0741c11219613863ac494c737cd8897","slug":"Linux常见命令/index","date":"2022-03-16T17:39:07.000Z","updated":"2022-03-16T17:39:46.634Z","comments":true,"path":"api/articles/Linux常见命令/index.json","keywords":null,"cover":null,"text":"1.常见操作命令cd home, cd home&#x2F;tomcat # 定位到某个目录 cd ..&#x2F; # 回到上一层目录 ls # 显示当前文件夹下的文件 tab键 # 自动完成 mkdir 文件夹名 # 新建文件夹 mv 旧名称 新名称 # 移动文件，也可以用来...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"操作系统","slug":"操作系统","count":1,"path":"api/categories/操作系统.json"}],"tags":[{"name":"Linux","slug":"Linux","count":1,"path":"api/tags/Linux.json"}],"author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}}},"next_post":{"title":"教你智能合约放弃所有权","uid":"3185ced86f4b8df05c544660439ae3e8","slug":"教你智能合约放弃所有权/index","date":"2022-03-16T16:53:39.000Z","updated":"2022-03-16T17:02:54.203Z","comments":true,"path":"api/articles/教你智能合约放弃所有权/index.json","keywords":null,"cover":null,"text":"准备工作 ERC20标准代币会自己发行 准备好【权限控制】相关代码 有足够的币来支付gas费用 对发布智能合约有疑问请参考我的另一篇文章《从零教你发行自己的以太坊ERC20智能合约》 相关操作请在需要拥有【丢弃权限】功能的合约中添加以下代码，发币完成后执行renounceOwne...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"发币教程","slug":"发币教程","count":4,"path":"api/categories/发币教程.json"}],"tags":[{"name":"区块链","slug":"区块链","count":5,"path":"api/tags/区块链.json"},{"name":"教程","slug":"教程","count":4,"path":"api/tags/教程.json"}],"author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}}}}